var mongoose = require('app/db/mongoose_connect.js');
var Schema = mongoose.Schema;
var ObjectId = Schema.Types.ObjectId;
var Soiree = require('app/db/Soiree.js');


/* Packages */
var shortid = require('shortid');
var _ = require("underscore");

/* Helper */
var helpersFolderLocation = "app/helpers/";
var ArrayHelper = require(helpersFolderLocation + 'ArrayHelper.js');

var DateHelper = require(helpersFolderLocation + 'DateHelper.js');
var ResHelper = require(helpersFolderLocation + 'ResHelper.js');
var CreditCardHelper = require(helpersFolderLocation + 'CreditCardHelper.js');
var LocationHelper = require(helpersFolderLocation + 'LocationHelper.js');
var PushNotificationHelper = require(helpersFolderLocation + 'PushNotificationHelper.js');
var Globals = require('app/helpers/Globals.js');
var ErrorCodes = require(helpersFolderLocation + 'ErrorCodes.js');


var customSchema = new Schema({

    },
    {
        discriminatorKey: '_type'
    }
);

customSchema.virtual('').get(function () {
});


customSchema.pre("save", function (next) {
    next();
});

customSchema.post("init", function (soiree) {

});

customSchema.statics.createDinnerSoiree = function(successCallback, errorCallback, options) {
    if (!options) options = {};

    var DinnerSoiree = this;

    var soireeType = "dinner";
    var soiree;
    if(options.date) {
        soiree = new DinnerSoiree({
            soireeType: soireeType,
            date: options.date,
        });
    }
    else {
        DinnerSoiree.determineDateForSoireeType(soireeType, function (date) {
            if (!date) return errorCallback(ErrorCodes.NoAvailableDate);

            soiree = new DinnerSoiree({
                soireeType: soireeType,
                date: date
            });
        });
    }
    DinnerSoiree.setSoireeDefaults(soiree, successCallback, errorCallback, options);
};

//var deepPopulate = require('mongoose-deep-populate')(mongoose);
//var options = {};
//customSchema.plugin(deepPopulate, options);

module.exports = Soiree.discriminator('DinnerSoiree', customSchema);