/**
 * Created by shadygabal on 12/16/15.
 */


    var ErrorCodes = require('app/helpers/ErrorCodes');
    var mongoose = require('app/db/mongoose_connect');

    var resHelper =  {
        sendMessage: function (res, status, message) {
            if (status >= 400)
                console.log(message);

            //res.type('text/plain');
            //res.status(status).send(message);
            res.status(status).json({"message" : message});

        },
        sendSuccess:function(res){
            res.json({});
        },
        sendError : function(res, error, additionalData){
            var responseObject = {};

            if (ErrorCodes[error]){
                responseObject["error"] = error;
            }
            else responseObject["error"] = error;
            if (additionalData && typeof additionalData === 'object'){
                var Globals = require('app/helpers/Globals');

                Globals.loopThroughObject(additionalData, function(key){
                   responseObject[key] = additionalData[key];
                });
            }

            res.status(418).json(responseObject);

        },
        render : function(req, res, view, options){

            var render = function(){

                if (view.indexOf("admins/") === 0 || view.indexOf("testing/") === 0){
                    if (req.admin && !options.admin) {
                        options.admin = req.admin;
                    }
                    if(!options.layout) {
                        options.layout = "admins/adminsLayout.hbs";
                    }
                }
                else if (view.indexOf("businesses/") === 0){
                    if (req.business && !options.business){
                        options.business = req.business;
                    }
                    if (!options.layout) {
                        options.layout = "businesses/businessesLayout.hbs";
                    }
                }
                else{
                    if (req.user && !options.user){
                        options.user = req.user;
                    }
                    if(!options.layout) {
                        options.layout = "consumer/consumerLayout.hbs";
                    }
                }

                if (!options.title){
                    options.title = "Soir√©e";
                }

                res.render(view, options);
            };

            //run any db queries you need before rendering, if desired
            if (req.admin){
                //always show number of verifications pending
                var UserVerification = mongoose.model("UserVerification");
                UserVerification.count({handled : false}, function(err, count){
                    if (err){
                        console.log(err);
                    }
                    options.numVerificationsPending = count;
                    render();
                });
            }
            else{
                render();
            }

        }

        //isNextDay: function (firstDate, secondDate) {
        //    var nextDayDiff = 1000 * 60 * 60 * 24;
        //    var midnightOne = new Date(firstDate.getFullYear(), firstDate.getMonth(), firstDate.getDay());
        //    var midnightTwo = new Date(secondDate.getFullYear(), secondDate.getMonth(), secondDate.getDay());
        //
        //    var diff = Math.abs(midnightTwo - midnightOne);
        //    return diff == nextDayDiff;
        //}

    };

//}());

module.exports = resHelper;
